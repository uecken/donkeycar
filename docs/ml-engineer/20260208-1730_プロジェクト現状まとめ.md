# プロジェクト現状まとめ

**作成日**: 2026年2月8日 17:30
**担当**: ml-engineer + robotcar-engineer
**目的**: 現状の学習方式・優先課題・技術的制約を整理

---

## 1. 現在の学習方式

### 1.1 採用方式

| 項目 | 設定 |
|------|------|
| **学習方法** | Donkey Car 標準方式（模倣学習 / Behavioral Cloning） |
| **モデルタイプ** | `linear` |
| **入力** | カメラ画像（120×160×3） |
| **出力** | Steering（連続値）、Throttle（連続値） |

### 1.2 模倣学習の特性

```
模倣学習 = 人間の運転を真似る
  → 学習データに含まれるルートのみ走行可能
  → 新しいルート（ショートカット）は学習データがないと走れない
```

**ショートカットを試すには**: ショートカットルートを含むデータを収集して学習する必要あり

---

## 2. 優先課題

### 2.1 最優先: スピード向上

**現状**: 3周 32秒

**対策**:
1. ブラシモーター制御の RC モータドライバ PWM 幅を拡大
2. 高速走行データを再収集
3. モデル再学習

```python
# myconfig.py 調整例
THROTTLE_FORWARD_PWM = XXX   # 上限を拡大
JOYSTICK_MAX_THROTTLE = 1.0  # 設定済み
```

### 2.2 高優先: ショートカット検証

**目的**: 現在の模倣学習（linear）方式でショートカット走行が可能か検証

**方法**:
1. ショートカットルートを含むデータ収集
2. モデル再学習
3. 走行テスト

**注意**: 模倣学習はデータにないルートは走れないため、ショートカットデータが必須

---

## 3. 技術的制約

### 3.1 推論速度

| 項目 | 値 | 備考 |
|------|-----|------|
| モデル形式 | TFLite (Float32) | Donkey Car 標準 |
| 推論時間（目安） | 40-80ms | 12-25Hz 相当 |
| 現在の推論 FPS | **未測定** | 要計測 |

### 3.2 Int8 量子化の制約

| 構成 | 対応 | 推論時間 |
|------|------|---------|
| Raspberry Pi 4 単体 | Float32 のみ実用的 | 40-80ms |
| Raspberry Pi 4 + Coral Edge TPU | Int8 対応 | 10-20ms |

**Coral Edge TPU USB Accelerator**:
- 製品: https://akizukidenshi.com/catalog/g/g114507/
- 効果: 推論速度 2-4 倍向上（10-20ms）
- **制約**: 部品変更は水曜日までのため、今回は導入困難

### 3.3 SLAM 統合について

| 項目 | 判断 |
|------|------|
| 必要性 | **現状は不要** |
| 理由 | コースが複雑でない、導入工数が大きい |
| 将来検討 | コース複雑化時に再検討 |

---

## 4. 次のアクション

| 優先度 | 担当 | アクション |
|--------|------|-----------|
| **最優先** | robotcar-engineer | PWM 幅拡大・モーター速度向上 |
| **最優先** | data-engineer | 高速走行データ再収集 |
| **高** | ml-engineer | モデル再学習 |
| **高** | robotcar-engineer | 現在の推論 FPS 測定 |
| 中 | data-engineer | ショートカットルートのデータ収集 |
| 中 | ml-engineer | ショートカット対応モデル学習 |

---

## 5. 測定項目（TODO）

### 5.1 推論 FPS 測定方法

```bash
# Raspberry Pi で実行
python manage.py drive --model models/mypilot.tflite --type tflite_linear --verbose

# プロファイルレポートで KerasPilot の時間を確認
# 200 ループごとに出力される
```

### 5.2 タイム計測

| 項目 | 現在値 | 目標値 |
|------|--------|--------|
| 3周タイム | 32秒 | 25秒以下？ |
| 1周平均 | ~10.7秒 | ~8秒以下？ |

---

## 6. 関連資料

- [20260203-1700_DonkeyCar学習推論詳細ガイド.md](20260203-1700_DonkeyCar学習推論詳細ガイド.md) - 学習・推論の仕組み
- [20260208-1700_AI_THROTTLE_MULT調査レポート.md](20260208-1700_AI_THROTTLE_MULT調査レポート.md) - スロットル制御
- [../robotcar-engineer/20260203-1620_制御周期分析レポート.md](../robotcar-engineer/20260203-1620_制御周期分析レポート.md) - 制御周期・推論速度
- [../slam-researcher/20260208-1720_SLAM技術調査レポート.md](../slam-researcher/20260208-1720_SLAM技術調査レポート.md) - SLAM 技術（参考）

---

## 7. まとめ

```
【現状】
・Donkey Car 標準の模倣学習（linear）を使用
・3周 32秒、スピード向上が最優先課題

【方針】
・PWM 幅拡大 → 高速データ収集 → 再学習
・ショートカットは模倣学習でも可能（データ収集が必要）
・SLAM は現状不要、Coral TPU も今回は見送り
```
