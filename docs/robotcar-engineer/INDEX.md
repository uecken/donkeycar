# robotcar-engineer 資料インデックス

**最終更新**: 2026年1月28日
**作成者**: robotcar-engineer

---

## 概要

このフォルダには、picopico_racersプロジェクト（HBX 2192ベース）のPWM制御・モータードライバー関連調査資料が含まれています。

---

## ファイル一覧と役割

### PCA9685関連（問題調査）

| ファイル | 役割 | 主な内容 |
|----------|------|----------|
| [PWM動作調査レポート](./20260128-1730_PWM動作調査レポート.md) | **PCA9685の問題点を特定** | 発振器精度問題（±20%偏差）、個体差、温度特性 |
| [RCサーボ許容範囲調査](./20260128-1830_RCサーボ許容範囲調査レポート.md) | **サーボ/ESCへの影響を分析** | PWM偏差がサーボ角度・ESC動作に与える影響の計算 |
| [キャリブレーション値保存調査](./20260128-1930_キャリブレーション値保存調査.md) | **設定の永続化方法を調査** | reference_clock_speedの保存機構、推奨対策 |

### GPIO直接制御・代替手段

| ファイル | 役割 | 主な内容 |
|----------|------|----------|
| [GPIO直接制御調査](./20260128-2000_GPIO直接制御調査.md) | **GPIO制御の全体像** | ハードウェアPWM 2チャンネル制限、Donkey Car対応状況、ピンID形式 |
| [HBX2192制御調査](./20260128-2010_HBX2192制御調査.md) | **HBX 2192固有の情報** | 車両仕様、5線式サーボ問題、推奨構成、HW/SW PWM混在検討 |
| [モータードライバーIC調査](./20260128-2100_モータードライバーIC調査.md) | **IC比較・選定** | TB6612FNG、DRV8835、TC78H660FNG等の詳細比較、安全性、購入先 |
| [DRV8835配線ガイド](./20260128-2130_DRV8835配線ガイド.md) | **具体的な実装手順** | 配線図、myconfig.py設定例、テストコード、トラブルシューティング |

---

## 読む順序（推奨）

### 背景を理解する場合

```
1. PWM動作調査レポート
   └── PCA9685の問題点を理解
2. RCサーボ許容範囲調査
   └── 影響の深刻さを理解
3. キャリブレーション値保存調査
   └── 対策の必要性を理解
```

### 実装を進める場合

```
1. HBX2192制御調査
   └── 車両の仕様と推奨構成を確認
2. GPIO直接制御調査
   └── ハードウェアPWM制限を理解
3. モータードライバーIC調査
   └── 使用するICを選定
4. DRV8835配線ガイド
   └── 実装手順に従って配線・設定
```

---

## 文書間の関係図

```
┌─────────────────────────────────────────────────────────────────────┐
│                      問題の特定                                      │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────────────────┐                                          │
│  │ PWM動作調査レポート   │──┬── PCA9685発振器±20%偏差              │
│  │ (1730)               │  │                                       │
│  └──────────────────────┘  │                                       │
│            │               │                                       │
│            ▼               │                                       │
│  ┌──────────────────────┐  │                                       │
│  │ RCサーボ許容範囲調査 │──┴── パルス幅誤差がサーボに影響          │
│  │ (1830)               │                                          │
│  └──────────────────────┘                                          │
│            │                                                        │
│            ▼                                                        │
│  ┌──────────────────────┐                                          │
│  │ キャリブレーション    │──── 永続化機能なし → 対策必要           │
│  │ 値保存調査 (1930)     │                                          │
│  └──────────────────────┘                                          │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
                    │
                    │ PCA9685の代わりに
                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                      代替手段の調査                                  │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────────────────┐                                          │
│  │ GPIO直接制御調査     │──── ハードウェアPWM 2ch制限              │
│  │ (2000)               │     Donkey Car対応状況                   │
│  └──────────────────────┘                                          │
│            │                                                        │
│            ▼                                                        │
│  ┌──────────────────────┐    ┌──────────────────────┐              │
│  │ HBX2192制御調査      │◄───│ モータードライバー   │              │
│  │ (2010)               │    │ IC調査 (2100)        │              │
│  │ 車両仕様・推奨構成   │    │ IC比較・選定         │              │
│  └──────────────────────┘    └──────────────────────┘              │
│            │                          │                             │
│            └──────────┬───────────────┘                             │
│                       ▼                                             │
│            ┌──────────────────────┐                                │
│            │ DRV8835配線ガイド   │──── 実装手順書                  │
│            │ (2130)               │                                 │
│            └──────────────────────┘                                │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 主要な結論

### PCA9685の問題

- 内部発振器の精度が±20%と低い（NXP公式）
- 個体差が大きく、キャリブレーションが必須
- 永続化機能がないため、起動ごとに設定が必要

### 推奨解決策

- **GPIO直接制御** + **モータードライバーIC**（TB6612FNG/DRV8835/TC78H660FNG）
- ハードウェアPWM 2チャンネルで十分（サーボ + モーター速度）
- **SERVO_HBRIDGE_3PINモードを使用**（推奨）

### ハードウェアPWM + ソフトウェアPWM混在構成の検討結果

**重要な発見**: Donkey Car現在の実装（`PwmPinPigpio`クラス）は、GPIO 13/18でも`hardware_PWM()`ではなく`set_PWM_dutycycle()`（pigpioソフトウェアPWM）を使用。

| 構成 | 技術的に可能 | 推奨度 | 備考 |
|------|-------------|--------|------|
| **SERVO_HBRIDGE_2PIN**（前進HW + 後退SW） | ○ 可能 | △ | 3チャンネル必要、排他動作なので実用可 |
| **SERVO_HBRIDGE_3PIN**（方向はTTL） | ○ 可能 | **★★★★★** | 2チャンネルで完結、シンプル |

**結論**: SERVO_HBRIDGE_2PINは技術的に動作するが、SERVO_HBRIDGE_3PINの方がシンプルで推奨

> **重要: 2S LiPoバッテリー電圧に注意**
> - 公称電圧: 7.4V
> - **満充電電圧: 8.4V**
> - モータードライバーは満充電電圧（8.4V）に対応できるものを選択
> - **TC78H653FTG（最大7.5V）は2S LiPo非対応** - TC78H660FNG（最大16V）と混同しないこと

### HBX 2192の推奨構成

```
構成B: SERVO_HBRIDGE_3PIN + DRV8835（推奨）
├── GPIO18 (PWM0) → サーボ信号
├── GPIO17 (TTL)  → DRV8835 APHASE（方向）
├── GPIO13 (PWM1) → DRV8835 AENBL（速度）
└── 370モーター（既存流用）

合計コスト: 約1,050円（DRV8835 550円 + MG90Sサーボ 500円）
```

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2026年1月28日 | インデックスファイル作成 |
| 2026年1月28日 | 2S LiPoバッテリー電圧（満充電8.4V）に関する注意事項を追記 |
| 2026年1月28日 | HW/SW PWM混在構成の検討結果を追記（SERVO_HBRIDGE_3PIN推奨） |
