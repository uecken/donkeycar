# RCサーボ許容範囲調査レポート

**作成日**: 2026年1月28日 18:30
**作成者**: robotcar-engineer
**目的**: PCA9685発振器偏差がRCサーボおよびESCに与える影響の調査

---

## 1. RCサーボの一般的な仕様と許容範囲

### 1.1 標準的なパルス幅仕様

RCサーボの位置制御は、PWM信号のパルス幅によって決定される。

| パラメータ | 標準値 | 備考 |
|-----------|--------|------|
| 最小パルス幅 | 1000μs (1ms) | 最小角度位置（-90°など） |
| ニュートラル | 1500μs (1.5ms) | 中央位置（0°） |
| 最大パルス幅 | 2000μs (2ms) | 最大角度位置（+90°など） |
| 拡張範囲 | 500〜2500μs | 一部サーボで対応 |

**重要な特性**:
- サーボ位置はPWMのデューティ比ではなく、**パルス幅のみ**によって決定される
- 同じ1.5msパルスでも、6ms周期（25%デューティ比）と25ms周期（6%デューティ比）で同じ位置に移動する
- メーカーや個体差により、実際の動作範囲は80〜100度程度と変動がある

### 1.2 パルス周期（周波数）の許容範囲

| 周波数帯 | 周期 | 評価 | 備考 |
|---------|------|------|------|
| 40〜50Hz | 25〜20ms | **推奨** | 全アナログサーボで安定動作 |
| 50〜100Hz | 20〜10ms | 良好 | 多くのサーボで問題なし |
| 100〜200Hz | 10〜5ms | 注意 | デジタルサーボ向け |
| 200Hz以上 | 5ms未満 | 要確認 | 高性能デジタルサーボ専用 |

**周波数に関する重要な知見**:

1. **40〜200Hzの範囲であれば、多くのRCサーボは正常動作する**
2. 周波数が低すぎる場合（40Hz未満）:
   - 応答速度が低下
   - アナログサーボでは保持トルクが減少
   - ジッター（微振動）が発生しやすい
3. 周波数が高すぎる場合（120Hz以上）:
   - 一部のアナログサーボで不安定化
   - 発熱・消費電流の増加
   - 最悪の場合、サーボ損傷の可能性

### 1.3 パルス幅の精度と角度への影響

標準的なサーボ（1000〜2000μs = 180度）の場合:

| パルス幅変化 | 角度変化 | 備考 |
|-------------|---------|------|
| 1000μs (全範囲) | 180° | 理論値 |
| 100μs | 18° | 10%の位置変化 |
| 10μs | 1.8° | 高精度制御に必要 |
| 1μs | 0.18° | 実用的な最小単位 |

**精度に関する考慮事項**:
- パルス幅のわずかなジッターがサーボ出力の振動（ツイッチング）を引き起こす
- 製造ばらつきにより、同じ信号でも個体差で異なる角度になる
- 実用的な精度は±5〜10μs程度で十分

---

## 2. PCA9685の発振器偏差による影響計算

### 2.1 PCA9685の発振器仕様

| パラメータ | 仕様値 | 備考 |
|-----------|--------|------|
| 公称発振周波数 | 25MHz | データシート記載 |
| **発振器許容偏差** | **±20%** | 未トリミング、NXP公式情報 |
| 実測偏差例 | 約-7〜+8% | ユーザー報告値 |
| PWM周波数範囲 | 24〜1526Hz | PRE_SCALE 3〜255 |
| PWM分解能 | 12bit (4096段階) | 固定 |

**PWM周波数計算式**:
```
PWM周波数 = 発振器周波数 / ((PRE_SCALE + 1) × 4096)
PRE_SCALE = (発振器周波数 / (4096 × 目標周波数)) - 1
```

### 2.2 50Hz設定時の発振器偏差影響

PRE_SCALE = 121 で50Hz設定時の影響:

| 発振器状態 | 実際の発振周波数 | 実際のPWM周波数 | 実際の周期 |
|-----------|-----------------|----------------|-----------|
| -20%偏差 | 20MHz | 40Hz | 25ms |
| -10%偏差 | 22.5MHz | 45Hz | 22.2ms |
| 公称値 | 25MHz | 50Hz | 20ms |
| +10%偏差 | 27.5MHz | 55Hz | 18.2ms |
| +20%偏差 | 30MHz | 60Hz | 16.7ms |

### 2.3 パルス幅への影響（詳細計算）

PCA9685では、パルス幅は12bitカウンタ値で設定される。

**1500μs（ニュートラル）設定の計算**:

50Hz（20ms周期）で1500μs を出力する場合:
```
カウンタ値 = (1500μs / 20000μs) × 4096 = 307.2 ≈ 307
```

**発振器偏差がある場合の実際のパルス幅**:

| 発振器偏差 | 実際の周期 | 同じカウンタ値(307)での実パルス幅 |
|-----------|-----------|--------------------------------|
| -20% | 25ms | 1875μs (+25%) |
| -10% | 22.2ms | 1667μs (+11%) |
| 公称 | 20ms | 1500μs (基準) |
| +10% | 18.2ms | 1364μs (-9%) |
| +20% | 16.7ms | 1250μs (-17%) |

### 2.4 具体的な数値例と影響

**例: -10%の発振器偏差がある場合**

| 設定パルス幅 | 計算カウンタ値 | 実際のパルス幅 | 誤差 |
|-------------|---------------|---------------|------|
| 1000μs (最小) | 205 | 1111μs | +111μs (+11%) |
| 1500μs (中央) | 307 | 1667μs | +167μs (+11%) |
| 2000μs (最大) | 410 | 2222μs | +222μs (+11%) |

**サーボ角度への影響**:
- 理論上の角度範囲: 1000-2000μs = 180°
- 実際の角度範囲: 1111-2222μs = 180° (シフトするがレンジは維持)
- **中央位置が約60°ずれる可能性**

---

## 3. ESC（電子スピードコントローラー）への影響

### 3.1 ESCの一般的な仕様

| パラメータ | 標準値 | 許容範囲 | 備考 |
|-----------|--------|---------|------|
| 最小スロットル | 1000μs | 800〜1250μs | アーム信号 |
| 最大スロットル | 2000μs | 1940〜2000μs | フルスロットル |
| ニュートラル | 1500μs | 1400〜1600μs | 停止/ブレーキ |
| PWM周波数 | 50Hz | 50〜490Hz | モデルにより異なる |
| アーム信号 | 975μs | 900〜1050μs | 起動前の認識信号 |

### 3.2 ESCへの周波数偏差影響

**許容範囲が広い理由**:
- ESCはサーボと異なり、パルス幅のみを検出
- 周波数の変動に対して比較的寛容
- 50〜490Hzの広範囲で動作可能なモデルが多い

**発振器偏差の影響**:

| 偏差 | PWM周波数 | ESCへの影響 |
|------|----------|------------|
| -20% | 40Hz | 応答遅延、通常動作 |
| -10% | 45Hz | 軽微な応答遅延 |
| 公称 | 50Hz | 正常動作 |
| +10% | 55Hz | 正常動作 |
| +20% | 60Hz | 正常動作 |

### 3.3 ESCキャリブレーションの重要性

**キャリブレーションプロセス**:
1. ESC電源投入時に最大スロットル信号を送信
2. ESCが最大値として記録
3. 最小スロットル信号を送信
4. ESCが最小値として記録

**PCA9685偏差への対処**:
- キャリブレーション実施により、偏差は自動補正される
- ただし、キャリブレーション時と運用時で温度が異なると問題発生の可能性
- **事前キャリブレーション推奨**

---

## 4. 調査結果のまとめと推奨事項

### 4.1 PCA9685発振器偏差の実用上の影響

| 影響項目 | 偏差範囲 | 評価 | 対策 |
|---------|---------|------|------|
| PWM周波数変動 | 40〜60Hz | 許容範囲内 | 問題なし |
| パルス幅誤差 | ±20% | 要対策 | キャリブレーション必須 |
| サーボ中央位置 | 大きくずれる可能性 | 要対策 | 個別調整必要 |
| ESC動作 | 概ね問題なし | 良好 | キャリブレーション推奨 |

### 4.2 推奨対策

#### 対策1: 発振器周波数のキャリブレーション
```python
# Adafruitライブラリでの発振器補正例
pca.reference_clock_speed = 実測発振周波数  # 例: 23000000 (23MHz)
```

#### 対策2: 個別サーボのパルス幅調整
- オシロスコープで実際のパルス幅を測定
- 1500μs出力時の実測値に基づいて補正係数を計算
- ソフトウェアで補正適用

#### 対策3: 外部クロック使用（高精度要求時）
- PCA9685のEXTCLKピンに外部発振器（最大50MHz）を接続
- 水晶発振器使用で±0.01%以下の精度達成可能

### 4.3 実用上の結論

| 用途 | PCA9685単体使用の可否 | 備考 |
|------|---------------------|------|
| ホビーRC | 可能 | キャリブレーション推奨 |
| Donkey Car | 可能 | 走行前に中央位置確認 |
| 精密制御 | 要対策 | 外部クロックまたはキャリブレーション必須 |
| 産業用途 | 非推奨 | 外部クロック必須 |

---

## 5. 参考資料

### Webリソース
- [Pololu - Servo control interface in detail](https://www.pololu.com/blog/17/servo-control-interface-in-detail)
- [Wikipedia - Servo control](https://en.wikipedia.org/wiki/Servo_control)
- [Adafruit Forums - PCA9685 Oscillator not very accurate](https://forums.adafruit.com/viewtopic.php?t=89102)
- [NXP Community - PCA9685 drive frequency tolerance details](https://community.nxp.com/t5/Other-NXP-Products/PCA9685-drive-frequency-tolerance-details/m-p/1732787)
- [Arduino Forum - PWM Accuracy for Hobby Servos](https://forum.arduino.cc/t/pwm-accuracy-for-hobby-servos-solved/530779)
- [RC Helicopter Fun - Understanding RC Servos](https://www.rchelicopterfun.com/rc-servos.html)
- [ArduPilot - ESC Calibration](https://ardupilot.org/copter/docs/esc-calibration.html)
- [KDE Direct - Understanding Throttle Calibration and ESC Deadbands](https://www.kdedirect.com/blogs/news/understanding-throttle-calibration-esc-deadbands-and-pwm)
- [How To Mechatronics - Arduino Brushless Motor Control Tutorial](https://howtomechatronics.com/tutorials/arduino/arduino-brushless-motor-control-tutorial-esc-bldc/)
- [Oscar Liang - How to Calibrate ESC](https://oscarliang.com/how-to-calibrate-esc/)

### データシート
- [PCA9685 Datasheet (Adafruit)](https://cdn-shop.adafruit.com/datasheets/PCA9685.pdf)

---

## 関連資料

このレポートと関連する他の調査資料：

| 資料名 | 内容 | リンク |
|--------|------|--------|
| PWM動作調査レポート | PCA9685発振器精度問題の詳細 | [20260128-1730_PWM動作調査レポート.md](./20260128-1730_PWM動作調査レポート.md) |
| キャリブレーション値保存調査 | 設定の永続化方法 | [20260128-1930_キャリブレーション値保存調査.md](./20260128-1930_キャリブレーション値保存調査.md) |
| GPIO直接制御調査 | PCA9685を使わない制御方法 | [20260128-2000_GPIO直接制御調査.md](./20260128-2000_GPIO直接制御調査.md) |

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2026年1月28日 | 初版作成 |
| 2026年1月28日 | 関連資料セクション追加 |
